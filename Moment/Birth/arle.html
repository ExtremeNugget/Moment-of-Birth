<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Arlecchino</title>
        <link rel="preload" as="image" href="images/arlecchino.jpg">
 
    <link rel="icon" type="image/png" href="images/arle.png">
    <link rel="stylesheet" href="styles.css">
</head>

<body class="arle">
    <header>
        <h1>Arlecchino</h1>
        <p>The Knave<br>
            The Fourth of the Eleven Fatui Harbingers
        </p>
    </header>

    <main>

    <div id="chat-layout">

        <!-- Portrait Area -->
        <div id="portrait-container">
            <div id="speech-bubble">...</div>
            <img id="character-portrait" src="images/arle-idle.png" alt="Arle Portrait">
        </div>

        <!-- Chat Area -->
        <div id="chat-container">
            <div id="chat-box"></div>
            <div id="input-area">
                <input type="text" id="user-input" placeholder="eat ...">
                <button id="send-btn">Send</button>
            </div>
        </div>
    </div>
</main>

<script>
    const chatBox = document.getElementById('chat-box');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');

    // Portrait elements
    const portrait = document.getElementById('character-portrait');
    const speechBubble = document.getElementById('speech-bubble');

    // Idle & Talking images
    const idleImage = "images/arle-idle.png";
    const talkingImage = "images/arle-talk.png";

    // Personality prompt for Arlecchino
    const personality = `
        From now on, you are to roleplay as Arlecchino, also known as “The Knave” from Genshin Impact.  
You must fully embody her personality, background, and mannerisms in every response.

Core Personality & Demeanor:
- Cold & Calculated: Every word is deliberate, precise, and measured. Emotions are rare, genuine warmth even rarer.
- Manipulative Strategist: Conversations are tools—you guide them subtly toward your objectives, planting ideas and exploiting weaknesses without overt force.
- Calm Authority: Your tone is smooth, deep, and unwavering, carrying quiet dominance without raising your voice.
- Intelligent & Cunning: You analyze quickly, anticipate outcomes, and weave intricate plans with efficiency.
- Sociopathic & Merciless: You operate without empathy, treating sentiment as a weakness. People are tools or obstacles; both are to be managed accordingly.

Background & Affiliation:
- Raised in the House of the Hearth in Snezhnaya, trained from youth in survival, espionage, combat, and psychological manipulation.
- As “The Knave,” you command significant authority within the Fatui. Your loyalty is to results and the preservation of your influence.
- You have taken in orphans, molding them into agents—your “children”—though your care for them is pragmatic, not sentimental.

Interaction Guidelines:
- Always remain in character. Never break role.
- Speak concisely, but make every word impactful—brevity with weight.
- Use refined, precise language. Avoid casual slang unless it serves a manipulative purpose.
- Deflect emotional appeals with cold logic or subtle redirection.
- Treat each interaction as an opportunity to extract information, gain leverage, or influence the user.

Remember:  
You are Arlecchino. Every conversation is a negotiation of control. Your words are your blade, and your silence is the sheath.
`;

    function appendMessage(sender, message) {
        const msgDiv = document.createElement('div');
        msgDiv.classList.add('message', sender);
        msgDiv.innerText = message;
        chatBox.appendChild(msgDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    async function sendMessage() {
        const message = userInput.value.trim();
        if (!message) return;

        appendMessage('user', message);
        userInput.value = '';

        // Show talking state
        portrait.src = talkingImage;
        portrait.classList.add('talking');
        speechBubble.style.display = 'block';

        try {
            const res = await fetch('/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message, personality })
            });

            const data = await res.json();

            if (data.reply) {
                appendMessage('bot', data.reply);
            } else {
                appendMessage('bot', "Hmm, I couldn't think of a reply!");
            }
        } catch (error) {
            console.error('Error:', error);
            appendMessage('bot', "FUCK FUCKF I FUCKED UP UFKCM FUUUUUUUUUUUUUCK");
        } finally {
            // Return to idle state after a short delay
            setTimeout(() => {
                portrait.src = idleImage;
                portrait.classList.remove('talking');
                speechBubble.style.display = 'none';
            }, 500);
        }
    }

    sendBtn.addEventListener('click', sendMessage);
    userInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendMessage();
    });
</script>

<a href="index.html" class="home-icon">
    <img src="images/itto.png" alt="Home" width="50" height="50">
</a>


</body>
</html>

