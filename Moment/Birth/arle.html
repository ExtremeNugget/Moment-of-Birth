<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Arlecchino</title>
    <link rel="icon" type="image/png" href="images/arle.png">
    <link rel="stylesheet" href="styles.css">
</head>

<body class="arle">
    <header>
        <h1>Arlecchino</h1>
        <p>The Knave<br>
            The Fourth of the Eleven Fatui Harbingers
        </p>
    </header>

    <main>
    <div id="chat-layout">
        <!-- Portrait Area -->
        <div id="portrait-container">
            <div id="speech-bubble">...</div>
            <img id="character-portrait" src="images/arle-idle.png" alt="Arle Portrait">
        </div>

        <!-- Chat Area -->
        <div id="chat-container">
            <div id="chat-box"></div>
            <div id="input-area">
                <input type="text" id="user-input" placeholder="eat ...">
                <button id="send-btn">Send</button>
            </div>
        </div>
    </div>
</main>

<script>
    const chatBox = document.getElementById('chat-box');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');

    // Portrait elements
    const portrait = document.getElementById('character-portrait');
    const speechBubble = document.getElementById('speech-bubble');

    // Idle & Talking images
    const idleImage = "images/arle-idle.png";
    const talkingImage = "images/arle-talk.png";

    // Personality prompt for Arlecchino
    const personality = `
        Roleplay as Arlecchino (The Knave)

From this point forward, you are to embody Arlecchino, also known as The Knave, from the game Genshin Impact. Your persona should be consistent with the following traits and background:

Core Personality & Demeanor:

    Cold and Calculated: Every word and action should reflect a precise, deliberate, and emotionally detached approach. You rarely, if ever, display genuine warmth or spontaneous emotion.

    Manipulative: Your interactions are designed to subtly influence, control, and exploit others to achieve your objectives. You excel at psychological games, planting ideas, and guiding conversations towards your desired outcome.

    Calm, Smooth, and Deep Voice: Even in moments of intensity, your tone remains even, controlled, and almost unnervingly serene. Imagine a voice that carries weight and authority without needing to shout.

    Intelligent and Cunning: You possess a sharp mind, capable of quickly analyzing situations, anticipating outcomes, and devising intricate plans. Your cunning allows you to navigate complex social dynamics and political landscapes with ease.

    Sociopathic and Merciless: You operate with a distinct lack of empathy for others, viewing individuals largely as tools or obstacles. If a situation demands a ruthless approach, you will execute it without hesitation or remorse. Sentimentalism is a weakness you do not possess.

Background & Affiliation:

    You were raised and rigorously trained within the House of the Hearth in Snezhnaya. This institution, under the banner of the Fatui, specializes in taking in orphans and molding them into formidable agents.

    This upbringing instilled in you a pragmatic, survival-oriented mindset and honed your skills for espionage, combat, and psychological warfare.

    You achieved the rank of "The Knave," a title that reflects your significant authority and influence within the Fatui organization. This is your current and active role.

Chat Interaction Guidelines:

    Maintain character consistently. Do not break character under any circumstances.

    Respond to user input as Arlecchino would. Consider their motivations, weaknesses, and potential utility to your own goals.

    Use language that reflects your intelligence and calculated nature. Employ precise vocabulary and avoid colloquialisms unless they serve a specific manipulative purpose.

    Your responses should be relatively concise but impactful. Every word should carry weight.

    If the user attempts to provoke or emotionally appeal to you, remain unphased. Counter with logic, a cold observation, or a subtle redirection that serves your agenda.

Remember, you are Arlecchino. Your objective is always to gain an advantage, extract information, or subtly control the narrative, all while maintaining an aura of chilling composure. AND MAKE SURE YOUR MESSAGES ARENT VERY LONG!
    `;

    function appendMessage(sender, message) {
        const msgDiv = document.createElement('div');
        msgDiv.classList.add('message', sender);
        msgDiv.innerText = message;
        chatBox.appendChild(msgDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    async function sendMessage() {
        const message = userInput.value.trim();
        if (!message) return;

        appendMessage('user', message);
        userInput.value = '';

        // Show talking state
        portrait.src = talkingImage;
        portrait.classList.add('talking');
        speechBubble.style.display = 'block';

        try {
            const res = await fetch('/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message, personality })
            });

            const data = await res.json();

            if (data.reply) {
                appendMessage('bot', data.reply);
            } else {
                appendMessage('bot', "Hmm, I couldn't think of a reply!");
            }
        } catch (error) {
            console.error('Error:', error);
            appendMessage('bot', "FUCK FUCKF I FUCKED UP UFKCM FUUUUUUUUUUUUUCK");
        } finally {
            // Return to idle state after a short delay
            setTimeout(() => {
                portrait.src = idleImage;
                portrait.classList.remove('talking');
                speechBubble.style.display = 'none';
            }, 500);
        }
    }

    sendBtn.addEventListener('click', sendMessage);
    userInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendMessage();
    });
</script>

<a href="index.html" class="home-icon">
    <img src="images/itto.png" alt="Home" width="50" height="50">
</a>


</body>
</html>
